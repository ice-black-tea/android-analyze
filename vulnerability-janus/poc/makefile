CC=g++
CPPFLAGS=-std=c++11 -lz -Iinclude
OBJ=obj

SRC=poc.cpp include/sha1.cpp
DEST=poc

LIB=lib
ZLIB_VERSION=1.2.11
ZLIB=$(LIB)/zlib-$(ZLIB_VERSION)

NBPROC=5

all: clean build run

build:
	mkdir $(OBJ)
	$(CC) $(SRC) -o $(OBJ)/$(DEST) $(CPPFLAGS)

run:
	./$(OBJ)/$(DEST) "../sample/app-release.apk" "../sample/out.dex" "../sample/out.apk"

clean:
	rm -rf $(OBJ)

zlib-init:
	mkdir -p $(LIB)

zlib-download: zlib-init
	wget -c -O "$(ZLIB).tar.gz" "http://zlib.net/zlib-$(ZLIB_VERSION).tar.gz"

zlib-unzip: zlib-download
	cd $(LIB) && tar -xf zlib-$(ZLIB_VERSION).tar.gz

zlib-configure: zlib-unzip
	cd $(ZLIB) && ./configure

zlib-compile: zlib-configure
	cd $(ZLIB) && make -j$(NBPROC)

zlib_uninstall:
	cd $(ZLIB) && make uninstall

zlib: zlib-compile
