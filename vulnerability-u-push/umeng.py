import frida, sys

process_name = "com.umeng.message.example"

jscode = """
Java.perform(function () {
    var Exception = Java.use("java.lang.Exception");
    var PushAgent = Java.use("com.umeng.message.PushAgent");

    var UmengDownloadResourceService = Java.use("com.umeng.message.UmengDownloadResourceService");
    UmengDownloadResourceService.onStartCommand.implementation = function(arg6, arg7, arg8) {
        PushAgent.getInstance(this).setDebugMode(true);
        send("UmengDownloadResourceService.onStartCommand");
        return this.onStartCommand(arg6, arg7, arg8);
    }

    var DownloadResourceTask = Java.use("com.umeng.message.UmengDownloadResourceService$DownloadResourceTask");
    DownloadResourceTask.$init.implementation = function(service, msg, opt) {
        this.$init(service, msg, opt);
    }

    DownloadResourceTask.download.implementation = function(str) {
        send("DownloadResourceTask.download   url: " + str);
        return this.download(str);
    }

    var UmengAdHandler = Java.use("com.umeng.message.UmengAdHandler");
    UmengAdHandler.getNotification.implementation = function(context, msg) {
        send("UmengAdHandler.getNotification");
        return this.getNotification(context, msg);
    }
});
"""

def on_message(message, data):
    if message['type'] == 'send':
        print("[*] {0}".format(message['payload']))
    else:
        print(message)

process = frida.get_usb_device().attach(process_name)
script = process.create_script(jscode)
script.on('message', on_message)
print('[*] Running ...')
script.load()
sys.stdin.read()
